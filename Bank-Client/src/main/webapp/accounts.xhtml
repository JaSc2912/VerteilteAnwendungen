<!DOCTYPE html>
<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:p="http://primefaces.org/ui"
  xmlns:f="http://xmlns.jcp.org/jsf/core"
>
  <ui:composition template="/templates/layout.xhtml">
    <ui:define name="title">Konten - Bank-Client</ui:define>

    <ui:define name="content">
      <f:metadata>
        <f:viewAction
          action="#{sessionService.loggedIn ? '' : 'index?faces-redirect=true'}"
        />
      </f:metadata>

      <div class="card">
        <div class="card-header">
          <h1 class="card-title">Kontenverwaltung</h1>
        </div>

        <h:form id="accountForm">
          <!-- Action buttons -->
          <div style="margin-bottom: 1rem">
            <p:commandButton
              value="Neues Konto erstellen"
              onclick="PF('createAccountDialog').show();"
              styleClass="ui-button-success"
              type="button"
            />

            <p:commandButton
              value="Ein-/Auszahlung"
              action="#{accountBean.openTransactionDialog}"
              update="transactionDialog"
              oncomplete="if (args.validationFailed !== true) PF('transactionDialog').show();"
              styleClass="ui-button-info"
              style="margin-left: 0.5rem"
            />

            <p:commandButton
              value="Überweisung"
              action="#{accountBean.openTransferDialog}"
              update="transferDialog"
              oncomplete="if (args.validationFailed !== true) PF('transferDialog').show();"
              styleClass="ui-button-warning"
              style="margin-left: 0.5rem"
            />
          </div>

          <!-- Accounts table -->
          <p:dataTable
            value="#{accountBean.accounts}"
            var="account"
            selectionMode="single"
            selection="#{accountBean.selectedAccount}"
            rowKey="#{account.kontonummer}"
            id="accountsTable"
            emptyMessage="Keine Konten vorhanden"
            styleClass="ui-table-striped"
          >
            <p:column headerText="Kontonummer" sortBy="#{account.kontonummer}">
              <h:outputText value="#{account.kontonummer}" />
            </p:column>

            <p:column headerText="Kontotyp" sortBy="#{account.kontotyp}">
              <h:outputText value="#{account.kontotyp}" />
            </p:column>

            <p:column headerText="Saldo" sortBy="#{account.saldo}">
              <h:outputText value="#{account.saldo}">
                <f:convertNumber type="currency" currencySymbol="€" />
              </h:outputText>
            </p:column>

            <p:column
              headerText="Erstellt am"
              sortBy="#{account.erstellungsdatum}"
            >
              <h:outputText value="#{account.erstellungsdatum}">
                <f:convertDateTime pattern="dd.MM.yyyy" />
              </h:outputText>
            </p:column>

            <p:column headerText="Aktionen">
              <p:commandButton
                value="Transaktionen"
                action="#{accountBean.loadTransactions(account.kontonummer)}"
                update="transactionHistoryDialog"
                oncomplete="PF('transactionHistoryDialog').show();"
                styleClass="ui-button-secondary ui-button-sm"
              />
            </p:column>
          </p:dataTable>
        </h:form>
      </div>

      <!-- Create Account Dialog -->
      <p:dialog
        header="Neues Konto erstellen"
        widgetVar="createAccountDialog"
        modal="true"
        resizable="false"
        width="400"
      >
        <h:form id="createAccountForm">
          <p:panelGrid columns="2" styleClass="ui-panelgrid-blank">
            <p:outputLabel for="accountType" value="Kontotyp:" />
            <p:selectOneMenu
              id="accountType"
              value="#{accountBean.newAccountType}"
            >
              <f:selectItem itemLabel="Girokonto" itemValue="GIROKONTO" />
              <f:selectItem itemLabel="Sparkonto" itemValue="SPARKONTO" />
              <f:selectItem
                itemLabel="Festgeldkonto"
                itemValue="FESTGELDKONTO"
              />
            </p:selectOneMenu>
          </p:panelGrid>

          <div style="text-align: right; margin-top: 1rem">
            <p:commandButton
              value="Abbrechen"
              onclick="PF('createAccountDialog').hide();"
              styleClass="ui-button-secondary"
              type="button"
              style="margin-right: 0.5rem"
            />
            <p:commandButton
              value="Erstellen"
              action="#{accountBean.createAccount}"
              update="accountForm:accountsTable"
              oncomplete="if (args.validationFailed !== true) PF('createAccountDialog').hide();"
              styleClass="ui-button-success"
            />
          </div>
        </h:form>
      </p:dialog>

      <!-- Transaction Dialog -->
      <p:dialog
        header="Ein-/Auszahlung"
        widgetVar="transactionDialog"
        modal="true"
        resizable="false"
        width="400"
        id="transactionDialog"
      >
        <h:form id="transactionForm">
          <p:panelGrid columns="2" styleClass="ui-panelgrid-blank">
            <p:outputLabel for="transactionType" value="Transaktionstyp:" />
            <p:selectOneMenu
              id="transactionType"
              value="#{accountBean.transactionType}"
            >
              <f:selectItem itemLabel="Einzahlung" itemValue="EINZAHLUNG" />
              <f:selectItem itemLabel="Auszahlung" itemValue="AUSZAHLUNG" />
            </p:selectOneMenu>

            <p:outputLabel for="transactionAmount" value="Betrag:" />
            <p:inputNumber
              id="transactionAmount"
              value="#{accountBean.transactionAmount}"
              symbol="€ "
              symbolPosition="p"
              decimalPlaces="2"
              required="true"
            />
          </p:panelGrid>

          <div style="text-align: right; margin-top: 1rem">
            <p:commandButton
              value="Abbrechen"
              onclick="PF('transactionDialog').hide();"
              styleClass="ui-button-secondary"
              type="button"
              style="margin-right: 0.5rem"
            />
            <p:commandButton
              value="Durchführen"
              action="#{accountBean.performTransaction}"
              update="accountForm:accountsTable"
              oncomplete="if (args.validationFailed !== true) PF('transactionDialog').hide();"
              styleClass="ui-button-success"
            />
          </div>
        </h:form>
      </p:dialog>

      <!-- Transfer Dialog -->
      <p:dialog
        header="Überweisung"
        widgetVar="transferDialog"
        modal="true"
        resizable="false"
        width="500"
        id="transferDialog"
      >
        <h:form id="transferForm">
          <p:panelGrid columns="2" styleClass="ui-panelgrid-blank">
            <p:outputLabel for="targetAccount" value="Zielkonto:" />
            <p:inputText
              id="targetAccount"
              value="#{accountBean.targetAccountNumber}"
              placeholder="Kontonummer des Empfängers"
              required="true"
            />

            <p:outputLabel for="transferAmount" value="Betrag:" />
            <p:inputNumber
              id="transferAmount"
              value="#{accountBean.transferAmount}"
              symbol="€ "
              symbolPosition="p"
              decimalPlaces="2"
              required="true"
            />

            <p:outputLabel
              for="transferDescription"
              value="Verwendungszweck:"
            />
            <p:inputTextarea
              id="transferDescription"
              value="#{accountBean.transferDescription}"
              rows="3"
              cols="30"
              placeholder="Beschreibung der Überweisung"
            />
          </p:panelGrid>

          <div style="text-align: right; margin-top: 1rem">
            <p:commandButton
              value="Abbrechen"
              onclick="PF('transferDialog').hide();"
              styleClass="ui-button-secondary"
              type="button"
              style="margin-right: 0.5rem"
            />
            <p:commandButton
              value="Überweisen"
              action="#{accountBean.transferMoney}"
              update="accountForm:accountsTable"
              oncomplete="if (args.validationFailed !== true) PF('transferDialog').hide();"
              styleClass="ui-button-success"
            />
          </div>
        </h:form>
      </p:dialog>

      <!-- Transaction History Dialog -->
      <p:dialog
        header="Transaktionshistorie"
        widgetVar="transactionHistoryDialog"
        modal="true"
        resizable="true"
        width="800"
        height="500"
        id="transactionHistoryDialog"
      >
        <h:form id="transactionHistoryForm">
          <p:dataTable
            value="#{accountBean.transactions}"
            var="transaction"
            emptyMessage="Keine Transaktionen vorhanden"
            styleClass="ui-table-striped"
          >
            <p:column
              headerText="Datum"
              sortBy="#{transaction.transaktionsdatum}"
            >
              <h:outputText value="#{transaction.transaktionsdatum}">
                <f:convertDateTime pattern="dd.MM.yyyy HH:mm" />
              </h:outputText>
            </p:column>

            <p:column headerText="Typ" sortBy="#{transaction.transaktionstyp}">
              <h:outputText value="#{transaction.transaktionstyp}" />
            </p:column>

            <p:column headerText="Betrag" sortBy="#{transaction.betrag}">
              <h:outputText value="#{transaction.betrag}">
                <f:convertNumber type="currency" currencySymbol="€" />
              </h:outputText>
            </p:column>

            <p:column headerText="Beschreibung">
              <h:outputText value="#{transaction.beschreibung}" />
            </p:column>
          </p:dataTable>

          <div style="text-align: right; margin-top: 1rem">
            <p:commandButton
              value="Schließen"
              onclick="PF('transactionHistoryDialog').hide();"
              styleClass="ui-button-secondary"
              type="button"
            />
          </div>
        </h:form>
      </p:dialog>
    </ui:define>
  </ui:composition>
</html>
